/*
 * jQuery Plugin: jQuery Facebook Album Browser
 * https://github.com/dejanstojanovic/Facebook-Album-Browser
 * Version 1.0.0
 *
 * Copyright (c) 2015 Dejan Stojanovic (http://dejanstojanovic.net)
 *
 * Released under the MIT license
 */
!function(t){t.fn.FacebookAlbumBrowser=function(e){var n={account:"",accessToken:"",showAccountInfo:!0,showImageCount:!0,skipEmptyAlbums:!0,skipAlbums:[],lightbox:!0,photosCheckbox:!0,albumSelected:null,photoSelected:null,photoChecked:null,photoUnchecked:null,showImageText:!1,likeButton:!0,checkedPhotos:[]},s=t.extend({},n,e),c=t(this);return c.each(function(e){function n(e){t.ajax({type:"GET",url:e,cache:!1,dataType:"jsonp",success:function(e){for(a=0;a<t(e.data).length;a++)if(!(s.skipAlbums.indexOf(t(e.data).get(a).name)>-1||s.skipAlbums.indexOf(t(e.data).get(a).id.toString())>-1)){var r=t("<li>",{"class":"fb-album","data-id":t(e.data).get(a).id});if(null!=t(e.data).get(a).count||!s.skipEmptyAlbums){var h="https://graph.facebook.com/"+t(e.data).get(a).cover_photo;""!=s.accessToken&&(h+="?access_token="+s.accessToken),t.ajax({type:"GET",url:h,cache:!1,data:{album:t(e.data).get(a).id},dataType:"jsonp",success:function(e){var a=t("li.fb-album[data-id='"+f("album",t(this).get(0).url)+"'] ");if(!t(e).get(0).error&&t(e).get(0).images){var n=a.width(),s=a.height(),c=t(e.images)[0];for(i=0;i<t(e.images).length;i++)t(e.images)[i].height>=s&&t(e.images)[i].width>=n&&t(e.images)[i].height<=c.height&&t(e.images)[i].width<=c.width&&(c=t(e.images)[i]);var o=t("<img>",{style:"margin-left:"+(n-c.width)/2+"px; display:none;","data-id":t(e).get(0).id,"class":"fb-album-thumb","data-src":c.source,src:""});a.append(o),t(o).load(function(){t(this).fadeIn(300)}),d(o),t(window).scroll(function(){t(".fb-album-thumb[src='']").each(function(){return d(t(this))}),t(".fb-photo-thumb[src='']").each(function(){return d(t(this))})})}else a.remove()}}),r.append(t("<div>",{"class":"fb-album-title",text:t(e.data).get(a).name})),s.showImageCount&&r.append(t("<div>",{"class":"fb-album-count",text:t(e.data).get(a).count})),t(b).append(r),t(r).click(function(){var e=t(this);t(c).append(t("<div>",{"class":"fb-album-preview"}));var a=c.find(".fb-album-preview");a.append(t("<img>",{alt:"",height:32,width:32,src:"data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiA/PjxzdmcgaGVpZ2h0PSIyMnB4IiB2ZXJzaW9uPSIxLjEiIHZpZXdCb3g9IjAgMCAyMiAyMiIgd2lkdGg9IjIycHgiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgeG1sbnM6c2tldGNoPSJodHRwOi8vd3d3LmJvaGVtaWFuY29kaW5nLmNvbS9za2V0Y2gvbnMiIHhtbG5zOnhsaW5rPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rIj48dGl0bGUvPjxkZWZzPjxwYXRoIGQ9Ik0wLDExIEMwLDQuOTI0ODY3NDUgNC45MjQ4Njc0NSwwIDExLDAgQzE3LjA3NTEzMjUsMCAyMiw0LjkyNDg2NzQ1IDIyLDExIEMyMiwxNy4wNzUxMzI1IDE3LjA3NTEzMjUsMjIgMTEsMjIgQzQuOTI0ODY3NDUsMjIgMCwxNy4wNzUxMzI1IDAsMTEgTDAsMTEgWiBNMjEsMTEgQzIxLDUuNDc3MTUyMjUgMTYuNTIyODQ3OCwxIDExLDEgQzUuNDc3MTUyMjUsMSAxLDUuNDc3MTUyMjUgMSwxMSBDMSwxNi41MjI4NDc4IDUuNDc3MTUyMjUsMjEgMTEsMjEgQzE2LjUyMjg0NzgsMjEgMjEsMTYuNTIyODQ3OCAyMSwxMSBMMjEsMTEgWiBNNS41LDExIEw4LjUsMTUgTDkuNSwxNSBMNi43NSwxMS40OTg0Mzc1IEwxNi41LDExLjQ5ODQzNzQgTDE2LjUsMTAuNSBMNi43NSwxMC41IEw5LjUsNyBMOC41LDcgTDUuNSwxMSBMNS41LDExIFoiIGlkPSJwYXRoLTEiLz48L2RlZnM+PGcgZmlsbD0ibm9uZSIgZmlsbC1ydWxlPSJldmVub2RkIiBpZD0ibWl1IiBzdHJva2U9Im5vbmUiIHN0cm9rZS13aWR0aD0iMSI+PGcgaWQ9ImNpcmNsZV9hcnJvdy1iYWNrX3ByZXZpb3VzX291dGxpbmVfc3Ryb2tlIj48dXNlIGZpbGw9IiMwMDAwMDAiIGZpbGwtcnVsZT0iZXZlbm9kZCIgeGxpbms6aHJlZj0iI3BhdGgtMSIvPjx1c2UgZmlsbD0ibm9uZSIgeGxpbms6aHJlZj0iI3BhdGgtMSIvPjwvZz48L2c+PC9zdmc+","class":"fb-albums-list"})),a.append(t("<h3>",{"class":"fb-album-heading",text:t(e).find(".fb-album-title").text()})),a.find("img.fb-albums-list,h3.fb-album-heading").click(function(){a.fadeOut(function(){t(c).find(".fb-albums").fadeIn(),a.remove()})}),t(a).append(t("<ul>",{"class":"fb-photos"})),photosContainer=t(a).find("ul.fb-photos");var i="https://graph.facebook.com/"+t(e).attr("data-id")+"/photos";""!=s.accessToken&&(i+="?access_token="+s.accessToken),null!=s.albumSelected&&"function"==typeof s.albumSelected&&s.albumSelected({id:t(e).attr("data-id"),url:i,thumb:t(e).find("img.fb-album-thumb").attr("src")}),o(i,photosContainer),t(c).find("ul.fb-albums").fadeOut(function(){a.fadeIn()})}),t(r).hover(function(){var e=t(this);e.find("div.fb-album-title").slideToggle(300)})}}e.paging&&e.paging.next&&""!=e.paging.next&&n(e.paging.next)}})}function o(e,n){t.ajax({type:"GET",url:e,cache:!1,dataType:"jsonp",success:function(e){for(a=0;a<e.data.length;a++){var c=t("<li>",{"class":"fb-photo"}),r=c.width(),h=c.height(),p=t(e.data)[a].images[0];for(i=0;i<t(e.data)[a].images.length;i++)t(e.data)[a].images[i].height>=h&&t(e.data)[a].images[i].width>=r&&t(e.data)[a].images[i].height<=p.height&&t(e.data)[a].images[i].width<=p.width&&(p=t(e.data)[a].images[i]);var f=t("<a>",{"class":"fb-photo-thumb-link",href:t(e.data)[a].source,"data-fb-page":t(e.data)[a].link}),u=0;if(r>0&&(u=(r-p.width)/2),s.photosCheckbox){var g=t("<div>",{"class":"image-check"});g.click(function(){var e={id:t(this).parent().find("img.fb-photo-thumb").attr("data-id"),url:t(this).parent().find("a").attr("href"),thumb:t(this).parent().find("img.fb-photo-thumb").attr("src")};if(t(this).toggleClass("checked"),t(this).hasClass("checked"))null!=s.photoChecked&&"function"==typeof s.photoChecked&&(s.checkedPhotos.push(e),s.photoChecked(e));else if(null!=s.photoUnchecked&&"function"==typeof s.photoUnchecked)for(i=0;i<s.checkedPhotos.length;i++)if(s.checkedPhotos[i].id==e.id){s.checkedPhotos.splice(i,1),s.photoUnchecked(e);break}return!1})}var b=t("<img>",{style:"margin-left:"+u+"px;display:none;","data-id":t(e.data).get(a).id,"class":"fb-photo-thumb","data-src":p.source,src:""}),m=t("<span>",{"class":"fb-photo-text"});if(m.text(t(e.data).get(a).name),f.append(m),f.append(b),s.photosCheckbox)for(c.append(g),i=0;i<s.checkedPhotos.length;i++)if(s.checkedPhotos[i].id==t(e.data).get(a).id){g.addClass("checked");break}c.append(f),n.append(c),t(b).load(function(){t(this).fadeIn(300)}),d(b),l(n.find("a.fb-photo-thumb-link"))}e.paging&&e.paging.next&&""!=e.paging.next&&o(e.paging.next,n)}})}function d(e){var a=null;return t(e).hasClass("fb-photo-thumb")?a=t(e).parent().parent():t(e).hasClass("fb-album-thumb")&&(a=t(e).parent()),null!=a?u(t(a))&&""==t(e).attr("src")?(t(e).attr("src",t(e).attr("data-src")),t(e).removeAttr("data-src"),!0):!1:!0}function r(e){var a=t("<div>",{"class":"fb-account-info"}),i=t("<a>",{target:"_blank",href:""});a.append(i),i.append(t("<img>",{src:"https://graph.facebook.com/"+s.account+"/picture?type=square"})),i.append(t("<h3>",{"class":"fb-account-heading"})),t(e).append(a),t.ajax({type:"GET",url:"https://graph.facebook.com/"+s.account,cache:!1,dataType:"jsonp",success:function(a){t(e).find(".fb-account-info").find(".fb-account-heading").text(a.name),t(e).find(".fb-account-info").find("a").attr("href","http://facebook.com/"+(a.username?a.username:a.id))}})}function h(e,a){if(s.likeButton){var i=t("<div>",{"data-show-faces":"false","class":"fb-like","data-href":a,"data-action":"like","data-layout":"box_count","data-share":"false","data-show-faces":"false"}),n=t("<div>",{"class":"fb-like-container"});n.append(i),e.prepend(n),FB.XFBML.parse()}}function l(e){var a=t(".fb-preview-overlay");if(0==a.length){a=t("<div>",{"class":"fb-preview-overlay"});var i=t("<div>",{"class":"fb-preview-content"});a.append(i),i.append(t("<img>",{"class":"fb-preview-img"})),(s.showImageText||s.likeButton)&&i.append(t("<span>",{"class":"fb-preview-text"})),a.append(t("<img>",{"class":"fb-preview-img-prev",src:"src/prev-icon.png"})),a.append(t("<img>",{"class":"fb-preview-img-next",src:"src/next-icon.png"})),t("body").append(a),a=t(".fb-preview-overlay"),t(a).click(function(){t(this).fadeOut()}),t(a).find(".fb-preview-img").click(function(){return t(this).parent().find("img.fb-preview-img-next").click(),!1}),s.likeButton&&(t("body").append("<div>",{id:"fb-root"}),function(t,e,a){var i,n=t.getElementsByTagName(e)[0];t.getElementById(a)||(i=t.createElement(e),i.id=a,i.src="//connect.facebook.net/en_US/sdk.js#xfbml=1&version=v2.3&appId=775908159169504",n.parentNode.insertBefore(i,n))}(document,"script","facebook-jssdk"))}else a=t(".fb-preview-overlay");t(e).unbind("click"),t(e).click(function(e){var a=t(".fb-preview-text"),i=t(".fb-preview-content");i.hide(),s.showImageText&&a.html(p(t(this).find(".fb-photo-text").text())),h(a,t(this).attr("data-fb-page"));var n={id:t(this).find("img.fb-photo-thumb").attr("data-id"),url:t(this).attr("href"),thumb:t(this).find("img.fb-photo-thumb").attr("data-id")};if(null!=s.photoSelected&&"function"==typeof s.photoSelected&&s.photoSelected(n),s.lightbox){var c=t(".fb-preview-overlay"),o=c.find("img.fb-preview-img");return o.hide(),c.find("img.fb-preview-img-prev,img.fb-preview-img-next").hide(),o.attr("src",t(this).attr("href")),/chrom(e|ium)/.test(navigator.userAgent.toLowerCase())&&t(o).show(),o.load(function(){i.css("display","block"),""!=a.text().trim()||s.likeBtn?a.css("display","block"):a.hide(),a.css("maxWidth",t(this).width()-12),t(this).show();var e=c.find("img.fb-preview-img-prev");e.show(),e.unbind("click"),e.click(function(){var e=t(this).parent().find(".fb-preview-img"),n=t("[href='"+e.attr("src")+"']");if(0!=n.length){var c=n.parent().prev(),d=null;0!=c.length?(d=c.find(".fb-photo-thumb-link"),o.attr("src",d.attr("href"))):(d=n.parent().parent().find("li").last().find(".fb-photo-thumb-link"),o.attr("src",d.attr("href"))),i.hide(),s.showImageText&&a.html(p(d.text())),h(a,d.attr("data-fb-page"))}return!1});var n=c.find("img.fb-preview-img-next");n.show(),n.unbind("click"),n.click(function(){var e=t(this).parent().find(".fb-preview-img"),n=t("[href='"+e.attr("src")+"']");if(0!=n.length){var c=n.parent().next(),d=null;0!=c.length?(d=c.find(".fb-photo-thumb-link"),o.attr("src",d.attr("href"))):(d=n.parent().parent().find("li").first().find(".fb-photo-thumb-link"),o.attr("src",d.attr("href"))),i.hide(),s.showImageText&&a.html(p(d.text())),h(a,d.attr("data-fb-page"))}return!1}),t(this).fadeIn()}),c.fadeIn(),e.preventDefault(),e.stopPropagation(),!1}})}function p(t){var e=/(https?:\/\/([-\w\.]+)+(:\d+)?(\/([\w\/_\.]*(\?\S+)?)?)?)/gi,a=t.replace(e,"<a href='$1' target='_blank'>$1</a>");return a}function f(t,e){t=t.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");var a=new RegExp("[\\?&]"+t+"=([^&#]*)"),i=a.exec(e);return null==i?"":decodeURIComponent(i[1].replace(/\+/g," "))}function u(e){{var a=t(e),i=t(window),n=i.scrollTop(),s=n+i.height(),c=a.offset().top;c+a.height()}return s>=c}var g=c.get(e);s.showAccountInfo&&r(g),t(g).append(t("<ul>",{"class":"fb-albums"}));var b=t(g).find(".fb-albums"),m="https://graph.facebook.com/"+s.account+"/albums";""!=s.accessToken&&(m+="?access_token="+s.accessToken),n(m)}),this}}(jQuery);